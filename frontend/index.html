<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Support Agent - Stage 1</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/chat.css">
    <link rel="stylesheet" href="assets/css/process-panel.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/alerts.css">
    <link rel="stylesheet" href="assets/css/animations.css">
</head>
<body>
    <!-- Context Monitoring Widget -->
    <div class="context-monitor" id="contextMonitor">
        <div class="context-monitor-title">
            ğŸ“Š Context Monitor
        </div>
        <div class="context-stat">
            <span class="context-label">Messages:</span>
            <span class="context-value" id="messageCount">0</span>
        </div>
        <div class="context-stat">
            <span class="context-label">Tokens:</span>
            <span class="context-value" id="tokenCount">~0</span>
        </div>
        <div class="context-stat">
            <span class="context-label">Tool Calls:</span>
            <span class="context-value" id="toolCallCount">0</span>
        </div>
        <div class="context-stat">
            <span class="context-label">Stage:</span>
            <span class="context-value" id="currentStage">1</span>
        </div>
        <div class="context-stat" id="threadIdStat" style="display: none;">
            <span class="context-label">Thread:</span>
            <span class="context-value" id="threadIdDisplay" style="font-size: 10px; cursor: pointer;" 
                  onclick="copyThreadId()" title="Click to copy">...</span>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div style="position: fixed; top: 10px; left: 50%; transform: translateX(-50%); z-index: 1100;">
        <div style="background: white; border-radius: 12px; padding: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); display: flex; gap: 8px; margin-bottom: 20px;">
            <button class="tab-button active" onclick="switchTab('chat')" id="chatTab">
                ğŸ’¬ Chat
            </button>
            <button class="tab-button" onclick="switchTab('debug')" id="debugTab">
                ğŸ Debug
            </button>
        </div>
    </div>

    <!-- Chat Container -->
    <div class="container" id="chatContainer">
        <!-- Stage Selector Sidebar -->
        <div class="stage-selector" id="stageSelector">
            <div class="stage-selector-header">
                ğŸ¯ Stage Selector
            </div>
            <div class="stage-selector-content">
                <select class="stage-dropdown" id="stageDropdown" onchange="switchStage()">
                    <option value="">Loading stages...</option>
                </select>
                <div class="stage-info" id="stageInfo">
                    Select a stage to begin
                </div>
                <div class="tools-list" id="toolsList"></div>
            </div>
        </div>

        <!-- Chat Panel -->
        <div class="chat-panel">
            <div class="panel-header">
                <div>ğŸ’¬ Customer Support Chat</div>
                <div class="subtitle" id="stageSubtitle">Loading...</div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ¤–</div>
                    <div>Welcome! I'm here to help with your order inquiries and store policies.</div>
                    <div style="margin-top: 10px; font-size: 14px;">Try asking: "What's the status of order #12345?"</div>
                </div>
            </div>
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input 
                        type="text" 
                        id="userInput" 
                        placeholder="Ask about your order or our policies..."
                        autocomplete="off"
                    >
                    <button id="sendButton">Send</button>
                </div>
            </div>
        </div>

        <!-- Thought Process Panel -->
        <div class="process-panel">
            <div class="panel-header" style="cursor: pointer;" onclick="toggleProcessPanel()">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div>ğŸ§  Agent Thought Process</div>
                        <div class="subtitle">ReAct: Reasoning & Actions</div>
                    </div>
                    <div id="toggleIcon" class="toggle-icon">âˆ’</div>
                </div>
            </div>
            <div class="process-content" id="processContent">
                <div class="empty-state">
                    <div class="empty-state-icon">âš™ï¸</div>
                    <div>Agent's reasoning steps will appear here</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Debug Container -->
    <div class="container" id="debugContainer">
        <!-- Stage Selector Sidebar -->
        <div class="stage-selector" id="stageSelectorDebug">
            <div class="stage-selector-header">
                ğŸ¯ Stage Selector
            </div>
            <div class="stage-selector-content">
                <select class="stage-dropdown" id="stageDropdownDebug" onchange="switchStage()">
                    <option value="">Loading stages...</option>
                </select>
                <div class="stage-info" id="stageInfoDebug">
                    Select a stage to begin
                </div>
                <div class="tools-list" id="toolsListDebug"></div>
            </div>
        </div>
        
        <!-- Checkpoint Debugger -->
        <div class="chat-panel">
            <div class="panel-header">
                <div>ğŸ› Checkpoint Debugger</div>
                <div class="subtitle">Time-travel through agent execution</div>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 20px;">
                <!-- Checkpointing Toggle -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #667eea;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div>
                            <div style="font-weight: 600; color: #333;">Checkpointing</div>
                            <div style="font-size: 12px; color: #666;">Enable memory and time-travel debugging</div>
                        </div>
                        <label style="position: relative; display: inline-block; width: 60px; height: 34px;">
                            <input type="checkbox" id="checkpointingToggle" onchange="toggleCheckpointing()" style="opacity: 0; width: 0; height: 0;">
                            <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px;">
                                <span style="position: absolute; content: ''; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                            </span>
                        </label>
                    </div>
                    <div id="checkpointingStatus" style="font-size: 12px; color: #666;">Loading status...</div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <input type="text" id="threadIdInput" placeholder="Enter thread ID (from session)..." 
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    <button onclick="loadCheckpoints()" style="margin-top: 10px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">
                        Load Checkpoints
                    </button>
                </div>
                <div id="checkpointTimeline"></div>
            </div>
        </div>
        
        <!-- Checkpoint Details Panel -->
        <div class="process-panel">
            <div class="panel-header">
                <div>ğŸ“Š Checkpoint Details</div>
                <div class="subtitle">State inspection</div>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 20px;" id="checkpointDetails">
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ”</div>
                    <div>Select a checkpoint to view details</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application Script (ES6 Module) -->
    <script type="module" src="assets/js/app.js"></script>
</body>
</html>
